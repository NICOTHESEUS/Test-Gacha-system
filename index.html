<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Drop Pod</title>
<style>
body { font-family: Arial, sans-serif; text-align: center; background: #222; color: white; transition: background 0.3s; }
button { padding: 10px 20px; margin: 10px; font-size: 16px; cursor: pointer; }
.result { margin-top: 20px; font-size: 20px; }
.alert { margin-top: 10px; color: red; font-weight: bold; }
.r10 { color: white; font-weight: bold; background: gold; padding: 2px 6px; border-radius: 4px; }
.r9 { color: gold; font-weight: bold; }
.r7 { color: orange; font-weight: bold; }
.r6 { color: violet; }
.r5 { color: pink; }
.r4 { color: cyan; }
.r3 { color: lightblue; }
.inventory { margin-top: 30px; text-align: left; max-width: 400px; margin-left: auto; margin-right: auto; }
.inventory h2 { text-align: center; }
.inv-item { padding: 6px; border-bottom: 1px solid #444; margin-bottom: 4px; cursor: pointer; }
.stats { font-size: 14px; color: #ccc; margin-top: 2px; }
.exp-bar-container { background: #444; width: 100%; height: 10px; border-radius: 5px; margin-top: 4px; }
.exp-bar { background: limegreen; height: 100%; border-radius: 5px; transition: width 0.3s; }
.exp-text { font-size: 12px; color: #ccc; margin-top: 2px; }
.upgrade-buttons { margin-top: 6px; }
.upgrade-buttons button { font-size: 12px; padding: 2px 6px; margin: 2px; }
</style>
</head>
<body>
<h1>ðŸš€ Drop Pod</h1>
<p>You have <span id="orbs">1600</span> Orbs | Scrap: <span id="scrap">0</span></p>
<p>Pity: <span id="pity">0</span> pulls since last 10â˜…</p>
<div class="alert" id="alertMsg"></div>

<button onclick="earnOrbs()">Earn 200 Orbs</button>
<br/>
<button onclick="pull(1)">Pull 1 (<span id="cost1">160</span>)</button>
<button onclick="pull(10)">Pull 10 (<span id="cost10">1600</span>)</button>
<button onclick="resetGame()">Reset Game</button>

<div class="result" id="results"></div>

<div class="inventory">
<h2>Inventory</h2>
<div id="inventoryList">Empty</div>
</div>

<script>
let orbs = localStorage.getItem("dropPodOrbs") ? parseInt(localStorage.getItem("dropPodOrbs")) : 1600;
let pity = localStorage.getItem("dropPodPity") ? parseInt(localStorage.getItem("dropPodPity")) : 0;
let inventory = localStorage.getItem("dropPodInventory") ? JSON.parse(localStorage.getItem("dropPodInventory")) : [];
let scrap = localStorage.getItem("dropPodScrap") ? parseInt(localStorage.getItem("dropPodScrap")) : 0;

const pool = [
  { name: "NICO Theseus", rarity: 10 },
  { name: "FREDRIK Astartes", rarity: 7 },
  { name: "Osiris", rarity: 9 },
  { name: "Architect", rarity: 9 },
  { name: "Placeholder 7", rarity: 6 },
  { name: "Placeholder 6", rarity: 5 },
  { name: "Placeholder 5", rarity: 4 },
  { name: "Placeholder 4", rarity: 3 },
  { name: "Placeholder 3", rarity: 3 },
  { name: "Placeholder 2", rarity: 3 },
  { name: "Placeholder 1", rarity: 3 },
];

const rates = {10:0.005,9:0.02,7:0.01,6:0.08,5:0.13,4:0.20,3:0.70};
const baseStats = {10:{hp:2000,atk:300,def:150},9:{hp:1500,atk:200,def:100},7:{hp:1000,atk:150,def:80},6:{hp:800,atk:120,def:60},5:{hp:600,atk:100,def:50},4:{hp:400,atk:80,def:30},3:{hp:200,atk:50,def:20}};
const maxLevel = {3:20,4:25,5:30,6:35,7:40,9:50,10:60};

// Select character to upgrade
let selectedCharIndex = null;

function chooseRarity(){pity++;let r=Math.random();let sum=0;const keys=Object.keys(rates).sort((a,b)=>b-a);for(let k of keys){let chance=rates[k];if(k==10 && pity>=50) chance=1;sum+=chance;if(r<=sum){if(parseInt(k)===10) pity=0;return parseInt(k);}}return 3;}
function getCharacter(rarity){let list=pool.filter(c=>c.rarity===rarity);return list[Math.floor(Math.random()*list.length)];}

function pull(times){
  let cost = times===10?1600:160;
  if(orbs<cost){ showAlert("Not enough Orbs!"); return; }
  orbs -= cost; clearAlert();

  let results=[]; let rareFlash=false;
  for(let i=0;i<times;i++){
    let rarity = chooseRarity();
    let chara = getCharacter(rarity);
    results.push(chara);
    addToInventory(chara);
    if(rarity>=9) rareFlash=true;
  }
  if(rareFlash){ document.body.style.backgroundColor='#444'; setTimeout(()=>document.body.style.backgroundColor='#222',300); }
  saveGame(); updateUI(); showResults(results);
}

function addToInventory(newChar){
  let found = inventory.find(c=>c.name===newChar.name && c.rarity===newChar.rarity);
  if(found){
    if(found.level < maxLevel[found.rarity]){
      found.exp = (found.exp||0)+1;
      let expNeeded = found.level*2;
      while(found.exp >= expNeeded && found.level < maxLevel[found.rarity]){
        found.exp -= expNeeded; found.level++;
        found.stats.hp = Math.round(baseStats[found.rarity].hp*(1+(found.level-1)*0.1));
        found.stats.atk = Math.round(baseStats[found.rarity].atk*(1+(found.level-1)*0.1));
        found.stats.def = Math.round(baseStats[found.rarity].def*(1+(found.level-1)*0.1));
        expNeeded = found.level*2;
      }
    } else {
      // Max level â†’ grant scrap
      let scrapGain = Math.floor(Math.random()*6)+5; // 5-10 scrap
      scrap += scrapGain;
      showAlert(`Extra duplicate! Gained ${scrapGain} scrap.`);
    }
  } else {
    inventory.push({...newChar, level:1, exp:0, stats:{...baseStats[newChar.rarity]}});
  }
}

function showResults(list){ let html="<h2>Results:</h2>"; list.forEach(c=>{ let cls="r"+c.rarity; html+=`<div class="${cls}">${c.name} (${c.rarity}â˜…)</div>`; }); document.getElementById("results").innerHTML=html; }

function earnOrbs(){ orbs+=200; saveGame(); updateUI(); }
function resetGame(){ if(!confirm("Reset everything?")) return; orbs=1600;pity=0;inventory=[];scrap=0;saveGame();updateUI();clearAlert(); }

function upgradeStat(index, stat){
  let char = inventory[index];
  if(scrap<=0){ showAlert("Not enough scrap!"); return; }
  let gain = Math.floor(Math.random()*6)+5; // +5-10%
  char.stats[stat] = Math.round(char.stats[stat]*(1+gain/100));
  scrap--; saveGame(); updateUI();
}

function saveGame(){
  localStorage.setItem("dropPodOrbs",orbs);
  localStorage.setItem("dropPodPity",pity);
  localStorage.setItem("dropPodInventory",JSON.stringify(inventory));
  localStorage.setItem("dropPodScrap",scrap);
}

function updateUI(){
  document.getElementById("orbs").innerText=orbs;
  document.getElementById("scrap").innerText=scrap;
  document.getElementById("pity").innerText=pity;
  const invEl = document.getElementById("inventoryList");
  if(inventory.length===0){ invEl.innerHTML="Empty"; return; }
  inventory.sort((a,b)=>b.rarity-a.rarity || a.name.localeCompare(b.name));
  invEl.innerHTML = inventory.map((c,i)=>{
    let cls="r"+c.rarity;
    let expPercent = (c.level<maxLevel[c.rarity]) ? (c.exp/(c.level*2))*100 : 100;
    let expText = (c.level
