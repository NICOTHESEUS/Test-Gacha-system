<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Galactic Drop Pod</title>
<style>
body { font-family: Arial,sans-serif; text-align:center; background:#222; color:white; margin:0; }
button { padding:10px 20px; margin:5px; cursor:pointer; }
.result { margin-top:20px; font-size:20px; }
.inventory, #achievementPanel, #battlePreview { margin-top:20px; padding:10px; border:2px solid #555; border-radius:12px; background:#111; max-width:600px; margin-left:auto;margin-right:auto; max-height:300px; overflow-y:auto; }
.inv-item { padding:4px; border-bottom:1px solid #444; cursor:pointer; }
.r3, .r4, .r5 { color:lightblue; font-weight:bold; }
.r6 { color:violet; font-weight:bold; }
.r7 { color:orange; font-weight:bold; }
.r8 { color:darkorange; font-weight:bold; }
.r9 { color:gold; font-weight:bold; }
.r10 { color:white; background:gold; padding:2px 6px; border-radius:4px; font-weight:bold; animation:glow 1.5s infinite; }
#mapPanel { position:relative; height:300px; background:#111; margin-top:10px; border-radius:12px; }
#gameNotifications { position:fixed; top:10px; right:10px; width:250px; z-index:9999; }
#bossHealthContainer { width:80%; height:20px; background:#333; border-radius:10px; margin:5px auto; display:none; }
#bossHealthBar { height:100%; width:100%; background:red; border-radius:10px; }
#loginPanel { margin-top:50px; }
@keyframes notifSlide {0%{opacity:0;transform:translateY(20px);}10%{opacity:1;transform:translateY(0);}90%{opacity:1;transform:translateY:0;}100%{opacity:0;transform:translateY(-20px);}}
@keyframes glow {0%{box-shadow:0 0 5px gold;}50%{box-shadow:0 0 20px gold;}100%{box-shadow:0 0 5px gold;}}
</style>
</head>
<body>

<div id="loginPanel">
  <h2>ðŸš€ Galactic Drop Pod</h2>
  <button onclick="googleLogin()">Login with Google</button>
</div>

<div id="gamePanel" style="display:none;">
<div id="resourceBar" style="display:flex;gap:20px;justify-content:center;margin-top:10px;">
  <div>ðŸš€ Orbs: <span id="orbsDisplay">1600</span></div>
  <div>ðŸ”§ Scrap: <span id="scrapDisplay">0</span></div>
  <div>ðŸ’Ž Boss Scrap: <span id="bossScrapDisplay">0</span></div>
  <div>ðŸ’¥ Overdrive: <span id="overdriveDisplay">None</span></div>
</div>

<div style="margin-top:15px;">
  <button onclick="pull(1)">Pull 1 (160 Orbs)</button>
  <button onclick="pull(10)">Pull 10 (1600 Orbs)</button>
  <button onclick="earnOrbs()">Earn 200 Orbs</button>
  <button onclick="resetGame()">Reset Game</button>
</div>

<div class="result" id="results"></div>

<div class="inventory">
  <h3>Units</h3>
  <div id="unitListPanel">Empty</div>
</div>

<div id="battlePreview">
  <div id="combatLog"></div>
  <div id="bossHealthContainer">
    <div id="bossHealthBar"></div>
  </div>
</div>

<div id="mapPanel"></div>

<div id="achievementPanel">
  <h3>Achievements</h3>
  <div id="achievementList"></div>
</div>
</div>

<div id="gameNotifications"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

<script>
// --- FIREBASE CONFIG ---
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// --- GOOGLE LOGIN ---
function googleLogin(){
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider)
      .then(result => {
          const user = result.user;
          showNotification(`Logged in as ${user.displayName}`);
          loadGameData(user.uid);
      })
      .catch(err => alert(err.message));
}

// --- GAME STATE ---
let orbs = 1600, scrap = 0, bossScrapA = 0;
let pullCount=0, legendaryBossesDefeated=0, eliteEventsDefeated=0;
let activeOverdrives = [];
let inventory = [];
let unitMaxLevel = 10;

// --- GACHA POOL ---
let pool = [
  {name:"NICO Theseus", rarity:10},{name:"FREDRIK Astartes", rarity:7},
  {name:"Osiris", rarity:9},{name:"Architect", rarity:9},
  {name:"Placeholder 7", rarity:6},{name:"Placeholder 6", rarity:5},
  {name:"Placeholder 5", rarity:4},{name:"Placeholder 4", rarity:3},
  {name:"Placeholder 3", rarity:3},{name:"Placeholder 2", rarity:3},
  {name:"Placeholder 1", rarity:3}
];

// --- RATES ---
const rawRates = {10:0.008,9:0.02,8:0.008,7:0.01,6:0.08,5:0.13,4:0.20,3:0.70};
const totalRate = Object.values(rawRates).reduce((a,b)=>a+b,0);
const rates = {}; for(let k in rawRates){ rates[k] = rawRates[k]/totalRate; }

// --- ACHIEVEMENTS ---
const achievements = [
  {id:1,name:"First Pull",description:"Perform your first Gacha Pull",condition:()=>pullCount>=1,reward:{orbs:50,scrap:50},unlocked:false},
  {id:2,name:"Collector",description:"Obtain 10 unique units",condition:()=>new Set(inventory.map(u=>u.name)).size>=10,reward:{scrap:200},unlocked:false},
  {id:3,name:"Elite Slayer",description:"Defeat 5 Elite Enemies",condition:()=>eliteEventsDefeated>=5,reward:{bossScrap:50},unlocked:false},
  {id:4,name:"Legendary Conqueror",description:"Defeat 1 Legendary Boss",condition:()=>legendaryBossesDefeated>=1,reward:{bossScrap:100,orbs:200},unlocked:false},
  {id:5,name:"Max Level Unit",description:"Level a unit to max level",condition:()=>inventory.some(u=>u.level>=unitMaxLevel),reward:{orbs:100},unlocked:false}
];

// --- MAP ---
let galaxyProgression = [
  {id:1,name:"Aurora Prime",type:"planet",x:20,y:50,unlocked:true},
  {id:2,name:"Crimson Outpost",type:"planet",x:120,y:80,unlocked:false},
  {id:3,name:"Obsidian Stronghold",type:"planet",x:220,y:40,unlocked:false},
  {id:4,name:"Celestial Nexus",type:"planet",x:320,y:100,unlocked:false}
];

// --- UTILITIES ---
function showNotification(msg,duration=3000){const notif=document.createElement("div");notif.innerText=msg;notif.style.background="#333";notif.style.padding="8px";notif.style.marginTop="5px";notif.style.borderRadius="6px";notif.style.animation=`notifSlide ${duration/1000}s ease forwards`;document.getElementById("gameNotifications").appendChild(notif);setTimeout(()=>notif.remove(),duration);}
function chooseRarity(){let r=Math.random(),sum=0;const keys=Object.keys(rates).sort((a,b)=>b-a);for(let k of keys){sum+=rates[k];if(r<=sum)return parseInt(k);}return 3;}
function getCharacter(rarity){let list=pool.filter(c=>c.rarity===rarity);return list[Math.floor(Math.random()*list.length)];}
function addToInventory(newChar){let found=inventory.find(u=>u.name===newChar.name);if(found){if(found.level<unitMaxLevel){found.level+=1;found.hp=Math.min(100+found.level*10,200);found.attack=Math.min(10+found.level*2,50);}}else{inventory.push({...newChar,level:1,hp:100,attack:10,defense:5,weapons:[],armor:[]});}}
function showResults(list){let html="<h4>Results:</h4>";list.forEach(c=>{let cls="r"+c.rarity;html+=`<div class="${cls}">${c.name} (${c.rarity}â˜…)</div>`});document.getElementById("results").innerHTML=html;}
function earnOrbs(){orbs+=200;updateUI(); saveGameData();}
function resetGame(){if(!confirm("Reset everything?")) return; orbs=1600;scrap=0;bossScrapA=0;inventory=[];updateUI(); saveGameData();}
function checkAchievements(){achievements.forEach(a=>{if(!a.unlocked&&a.condition()){a.unlocked=true;claimAchievementReward(a)}});renderAchievements();}
function claimAchievementReward(a){if(a.reward.orbs) orbs+=a.reward.orbs;if(a.reward.scrap) scrap+=a.reward.scrap;if(a.reward.bossScrap) bossScrapA+=a.reward.bossScrap;showNotification(`ðŸ† Achievement Unlocked: ${a.name}! Reward: ${JSON.stringify(a.reward)}`); saveGameData();}
function renderAchievements(){const panel=document.getElementById("achievementList");panel.innerHTML="";achievements.forEach(a=>{const div=document.createElement("div");div.className="inv-item";div.style.opacity=a.unlocked?"0.6":"1";div.innerHTML=`<strong>${a.name}</strong> - ${a.description} ${a.unlocked?"âœ…":""}`;panel.appendChild(div);});}
function renderMap(){const mapPanel=document.getElementById("mapPanel");mapPanel.innerHTML="";galaxyProgression.forEach(loc=>{const marker=document.createElement("div");marker.style.position="absolute";marker.style.width="50px";marker.style.height="50px";marker.style.borderRadius="50%";marker.style.left=loc.x+"px";marker.style.top=loc.y+"px";marker.style.background=loc.unlocked?"#0af":"#444";marker.style.cursor=loc.unlocked?"pointer":"not-allowed";marker.title=loc.name+(loc.unlocked?"":" (Locked)");if(loc.unlocked){marker.onclick=()=>previewBattle({name:loc.name,difficulty:1,baseHP:100,enemies:3,boss:Math.random()>0.7,reward:{scrap:50,bossScrap:Math.random()>0.7?10:0}});}mapPanel.appendChild(marker);});}
function updateUI(){document.getElementById("orbsDisplay").innerText=orbs;document.getElementById("scrapDisplay").innerText=scrap;document.getElementById("bossScrapDisplay").innerText=bossScrapA;document.getElementById("overdriveDisplay").innerText=activeOverdrives.length>0?activeOverdrives.map(o=>o.name).join(","):"None";renderUnitListPanel();renderMap();renderAchievements();}
function renderUnitListPanel(){const panel=document.getElementById("unitListPanel");panel.innerHTML="";inventory.forEach(u=>{const div=document.createElement("div");div.className="inv-item r"+u.rarity;div.innerText=`${u.name} Lv.${u.level} HP:${u.hp}`;panel.appendChild(div);});}

// --- GACHA ---
function pull(times){if(times<=0)return;const costPerPull=160;const totalCost=costPerPull*times;if(orbs<totalCost){alert("Not enough Orbs!");return;}orbs-=totalCost;pullCount+=times;const results=[];for(let i=0;i<times;i++){let rarity=chooseRarity();let chara=getCharacter(rarity);results.push(chara);addToInventory(chara);}updateUI(); showResults(results); checkAchievements(); saveGameData();}

// --- BATTLE FUNCTIONS ---
function previewBattle(mission){const preview=document.getElementById("battlePreview");preview.innerHTML=`<h4>Mission: ${mission.name}</h4><p>Difficulty: ${mission.difficulty}</p><p>Enemies: ${mission.enemies}</p><p>Boss: ${mission.boss?"Yes":"No"}</p><button onclick="startMission('${mission.name}',${mission.boss},${mission.baseHP},${mission.reward.scrap},${mission.reward.bossScrap},${mission.enemies})">Start Mission</button>`;document.getElementById("bossHealthContainer").style.display=mission.boss?"block":"none";}
function startMission(name,isBoss=false,bossHP=100,scrapReward=50,bossScrapReward=0,totalEnemies=3){if(inventory.length===0){alert("No units! Pull some first.");return;}const battleDiv=document.getElementById("battlePreview");battleDiv.innerHTML+="<div id='combatAnimation' style='position:relative;width:100%;height:150px;'></div>";const animDiv=document.getElementById("combatAnimation");let missionHP=bossHP;let aliveUnits=inventory.filter(u=>u.hp>0);function simulateTurn(i){if(i>=totalEnemies||aliveUnits.length===0){scrap+=scrapReward;if(isBoss){bossScrapA+=bossScrapReward;legendaryBossesDefeated++;}showNotification(`âœ… Mission Completed! Loot: ${scrapReward} Scrap${isBoss? ', '+bossScrapReward+' Boss Scrap':''}`);checkAchievements();updateUI(); saveGameData(); return;}const unit=aliveUnits[Math.floor(Math.random()*aliveUnits.length)];const damage=Math.floor(Math.random()*10+5);if(isBoss)missionHP=Math.max(0,missionHP-damage);showDamageNumber(animDiv,damage);battleDiv.innerHTML+=`<div>${unit.name} dealt ${damage} damage!</div>`;if(isBoss)updateBossHP(missionHP,bossHP);const enemyDamage=Math.floor(Math.random()*5+3);const targetUnit=aliveUnits[Math.floor(Math.random()*aliveUnits.length)];targetUnit.hp=Math.max(0,targetUnit.hp-enemyDamage);showDamageNumber(animDiv,enemyDamage,false);battleDiv.innerHTML+=`<div style='color:red'>Enemy dealt ${enemyDamage} damage to ${targetUnit.name}</div>`;aliveUnits=aliveUnits.filter(u=>u.hp>0);setTimeout(()=>simulateTurn(i+1),500);}simulateTurn(0);}
function updateBossHP(currentHP,maxHP){const bar=document.getElementById("bossHealthBar");bar.style.width=(currentHP/maxHP*100)+"%";if(currentHP<=0)showNotification("ðŸ”¥ Boss
